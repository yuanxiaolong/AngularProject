'use strict';
/**
 * 图表Overview页
 */
angular.module('jannaApp')
    .controller('ChartsCtrl', function ($scope, $timeout, $interval, httpHepler, loginerHepler, constHepler, chartHelper) {

        $scope.currentMenu = "charts";

        //mock
        var mockTypes = '[{"dataTypeDesc":"","dataTypeName":"CHANNEL.ch_111","gmtCreated":"","gmtCreator":"","gmtModified":"","gmtModifier":"","id":100},{"dataTypeDesc":"","dataTypeName":"CHANNEL.ch_112","gmtCreated":"","gmtCreator":"","gmtModified":"","gmtModifier":"","id":101}]';
        $scope.types = $.parseJSON(mockTypes);

        //httpHepler.doGet(constHepler.vayneUrl + '/dataRecordsMerge/type', $scope.formData, function (data) {
        //    $scope.types = data;
        //});



        var dataDate = moment().format('YYYY-MM-DD');

        // 基于准备好的dom，初始化echarts图表
        var lineChart = echarts.init(document.getElementById('chart-overview-line'));
        //var detailChart = echarts.init(document.getElementById('chart-overview-bar'));


        var userId = loginerHepler.doGet({});

        //mock
        var mockData = '{"axis":["2015-09-18 00:00:00","2015-09-18 00:10:00","2015-09-18 00:20:00","2015-09-18 00:30:00","2015-09-18 00:40:00","2015-09-18 00:50:00","2015-09-18 01:00:00","2015-09-18 01:10:00","2015-09-18 01:20:00","2015-09-18 01:30:00","2015-09-18 01:40:00","2015-09-18 01:50:00","2015-09-18 02:00:00","2015-09-18 02:10:00","2015-09-18 02:20:00","2015-09-18 02:30:00","2015-09-18 02:40:00","2015-09-18 02:50:00","2015-09-18 03:00:00","2015-09-18 03:10:00","2015-09-18 03:20:00","2015-09-18 03:30:00","2015-09-18 03:40:00","2015-09-18 03:50:00","2015-09-18 04:00:00","2015-09-18 04:10:00","2015-09-18 04:20:00","2015-09-18 04:30:00","2015-09-18 04:40:00","2015-09-18 04:50:00","2015-09-18 05:00:00","2015-09-18 05:10:00","2015-09-18 05:20:00","2015-09-18 05:30:00","2015-09-18 05:40:00","2015-09-18 05:50:00","2015-09-18 06:00:00","2015-09-18 06:10:00","2015-09-18 06:20:00","2015-09-18 06:30:00","2015-09-18 06:40:00","2015-09-18 06:50:00","2015-09-18 07:00:00","2015-09-18 07:10:00","2015-09-18 07:20:00","2015-09-18 07:30:00","2015-09-18 07:40:00","2015-09-18 07:50:00","2015-09-18 08:00:00","2015-09-18 08:10:00","2015-09-18 08:20:00","2015-09-18 08:30:00","2015-09-18 08:40:00","2015-09-18 08:50:00","2015-09-18 09:00:00","2015-09-18 09:10:00","2015-09-18 09:20:00","2015-09-18 09:30:00","2015-09-18 09:40:00","2015-09-18 09:50:00","2015-09-18 10:00:00","2015-09-18 10:10:00","2015-09-18 10:20:00","2015-09-18 10:30:00","2015-09-18 10:40:00","2015-09-18 10:50:00","2015-09-18 11:00:00","2015-09-18 11:10:00","2015-09-18 11:20:00","2015-09-18 11:30:00","2015-09-18 11:40:00","2015-09-18 11:50:00","2015-09-18 12:00:00","2015-09-18 12:10:00","2015-09-18 12:20:00","2015-09-18 12:30:00","2015-09-18 12:40:00","2015-09-18 12:50:00","2015-09-18 13:00:00","2015-09-18 13:10:00","2015-09-18 13:20:00","2015-09-18 13:30:00","2015-09-18 13:40:00","2015-09-18 13:50:00","2015-09-18 14:00:00","2015-09-18 14:10:00","2015-09-18 14:20:00","2015-09-18 14:30:00","2015-09-18 14:40:00","2015-09-18 14:50:00","2015-09-18 15:00:00","2015-09-18 15:10:00","2015-09-18 15:20:00","2015-09-18 15:30:00","2015-09-18 15:40:00","2015-09-18 15:50:00","2015-09-18 16:00:00","2015-09-18 16:10:00","2015-09-18 16:20:00","2015-09-18 16:30:00","2015-09-18 16:40:00","2015-09-18 16:50:00","2015-09-18 17:00:00","2015-09-18 17:10:00","2015-09-18 17:20:00","2015-09-18 17:30:00","2015-09-18 17:40:00","2015-09-18 17:50:00","2015-09-18 18:00:00","2015-09-18 18:10:00","2015-09-18 18:20:00","2015-09-18 18:30:00","2015-09-18 18:40:00","2015-09-18 18:50:00","2015-09-18 19:00:00","2015-09-18 19:10:00","2015-09-18 19:20:00","2015-09-18 19:30:00","2015-09-18 19:40:00","2015-09-18 19:50:00","2015-09-18 20:00:00","2015-09-18 20:10:00","2015-09-18 20:20:00","2015-09-18 20:30:00","2015-09-18 20:40:00","2015-09-18 20:50:00","2015-09-18 21:00:00","2015-09-18 21:10:00","2015-09-18 21:20:00","2015-09-18 21:30:00","2015-09-18 21:40:00","2015-09-18 21:50:00","2015-09-18 22:00:00","2015-09-18 22:10:00","2015-09-18 22:20:00","2015-09-18 22:30:00","2015-09-18 22:40:00","2015-09-18 22:50:00","2015-09-18 23:00:00","2015-09-18 23:10:00","2015-09-18 23:20:00","2015-09-18 23:30:00","2015-09-18 23:40:00","2015-09-18 23:50:00"],"legend":["汇总"],"series":[{"data":[7044309,6372299,5755653,5096355,4994234,4715614,4222964,3714894,3154901,2855219,2659332,2475661,2295314,3003937,1965373,1858460,1664063,2460936,1705881,1648691,1512570,2200584,1503347,1540585,1419335,1420466,1345250,1318457,1298428,1252336,1228491,1275398,1253694,1268348,1298401,1341148,1447949,1586895,1595633,1707580,1973424,1900658,2010080,2036674,2067913,2141167,2238632,2352686,2582102,3027261,3663846,3874209,4547076,4510645,4751931,4783633,6099133,4839164,5118513,5408749,5669601,6204373,6571446,6733414,6983092,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"name":"汇总","type":"line"}]}';
        var jsonData = $.parseJSON(mockData);
        chartHelper.drawLine("all", lineChart, jsonData , '当日数据', '分钟合并', 'HH:mm', false);

        // 先请求一次
        //httpHepler.doGet(constHepler.vayneUrl + '/dataRecordsMerge/draw', {
        //    userId: userId,
        //    bussNo: "all", //固定写死
        //    period: "10",//固定写死,因为是按日
        //    beginTime: dataDate + " 00:00:00",//encodeURI(chooseDate + " 00:00:00"),
        //    endTime: moment().add(1, 'days').format('YYYY-MM-DD') + " 00:00:00",//encodeURI(chooseDate + " 00:00:00")
        //    chartType: 'line'
        //}, function (data) {
        //    if (data) {
        //        chartHelper.drawLine("all", lineChart, data, '当日数据', '分钟合并', 'HH:mm', false);
        //    }
        //});


        //$scope.redraw = function () {
        //    var bNo = $scope.bNo;
        //    if (bNo != '' && bNo != undefined) {
        //        var beginTime = moment().format('YYYY-MM-DD')
        //        var endTime = moment().add(1, 'days').format('YYYY-MM-DD');
        //        //var userId = loginerHepler.doGet({});
        //
        //        httpHepler.doGet(constHepler.vayneUrl + '/dataRecordsMerge/drawAll', {
        //            //userId: userId,
        //            bussNo: bNo,
        //            period: "10",
        //            beginTime: beginTime + " 00:00:00",//encodeURI(chooseDate + " 00:00:00"),
        //            endTime: endTime + " 00:00:00",//encodeURI(chooseDate + " 00:00:00")
        //            chartType: 'line'
        //        }, function (data) {
        //            if (data) {
        //                chartHelper.drawBar("all", detailChart, data, '当日数据', '分钟合并', 'HH:mm', false);
        //            }
        //        });
        //    }
        //};


        // 10秒刷新
        //$interval(function () {
        //    console.log(moment().format('YYYY-MM-DD HH:mm:ss'));
        //    httpHepler.doGet(constHepler.vayneUrl + '/dataRecordsMerge/draw', {
        //        userId: userId,
        //        bussNo: "all", //固定写死
        //        period: "10",//固定写死,因为是按日
        //        beginTime: dataDate + " 00:00:00",//encodeURI(chooseDate + " 00:00:00"),
        //        endTime: moment().add(1, 'days').format('YYYY-MM-DD') + " 00:00:00",//encodeURI(chooseDate + " 00:00:00")
        //        chartType: 'line'
        //    }, function (data) {
        //        if (data) {
        //            chartHelper.drawLine("all", lineChart, data, '当日数据', '分钟合并', 'HH:mm', false);
        //        }
        //    });
        //}, 10000);

    });


